---
import { contentfulClient } from "../../lib/contentful";
import { Image } from "@unpic/astro";

import Layout from "../../layouts/Layout.astro";
import "../../styles/global.scss";

interface SingleWork {
  name: string;
  title: string;
  color: string;
  thumbnail: any;
  thumbnailAspectRatio: number;
  image: any;
}

interface SingleWorkObject {
  fields: SingleWork;
}

interface WorksPage {
  name: string;
  works: SingleWorkObject[];
}

const entries = await contentfulClient.getEntries<WorksPage>({
  content_type: "worksPage",
  limit: 1,
});

const works: SingleWork[] = entries.items[0].fields.works.map(
  (work: SingleWorkObject) => {
    const thumbnail = work.fields.thumbnail
      ? work.fields.thumbnail
      : work.fields.image;
    return {
      ...work.fields,
      thumbnail: thumbnail,
      thumbnailAspectRatio:
        thumbnail.fields.file.details.image.width /
        thumbnail.fields.file.details.image.height,
    };
  }
);

console.log(works[0].thumbnail.fields.file.details.image.width);
---

<Layout title="Works - Paulina WÅ‚ostowska">
  <main class="container">
    <ul class="works-grid">
      {
        works.map((work, index) => (
          <li class="work">
            <a
              class="work__link"
              href={`/works/${index + 1}`}
              style={`aspect-ratio: ${work.thumbnail.fields.file.details.image.width} / ${work.thumbnail.fields.file.details.image.height}`}
            >
              <img
                src={`${work.thumbnail.fields.file.url}?h=${400}&q=72&fm=webp`}
                width={200 * work.thumbnailAspectRatio}
                height={200}
                alt={work.thumbnail.fields.title}
                loading="lazy"
              />
            </a>
          </li>
        ))
      }
    </ul>
  </main>
</Layout>

<style lang="scss">
  .works-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 32px;
  }

  .work {
    position: relative;
    width: auto;
    cursor: pointer;
    color: var(--accent-color);

    &__link {
      position: relative;
      z-index: 1;
      display: block;
      height: max(200px, 13vw);
      overflow: hidden;
    }

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      transform-origin: center;
      transition: .5s ease;
    }

    @media (hover: hover) {
      &:hover {
        img {
          transform: scale(1.1);
        }
      }
    }
  }
</style>
